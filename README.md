# Cloudflare Tunnel Manager v3.0 - å¢å¼ºç‰ˆ

## ğŸš€ æ–°å¢åŠŸèƒ½æ¦‚è§ˆ

### 1. Cloudflare API é›†æˆ â­â­â­

#### å·²å®ç°
- âœ… API Token é…ç½®å’ŒéªŒè¯
- âœ… Account ID è‡ªåŠ¨è·å–
- âœ… API è¿æ¥æµ‹è¯•

#### å¾…å®ç°
```rust
// DNS è®°å½•ç®¡ç†
- åˆ—å‡ºæ‰€æœ‰ DNS è®°å½•
- æ·»åŠ /æ›´æ–°/åˆ é™¤ DNS è®°å½•
- æ‰¹é‡å¯¼å…¥ DNS è®°å½•
- è‡ªåŠ¨åŒæ­¥éš§é“è·¯ç”±åˆ° DNS

// éš§é“ API ç®¡ç†
- é€šè¿‡ API åˆ›å»º/åˆ é™¤éš§é“
- è·å–éš§é“ç»Ÿè®¡ä¿¡æ¯
- é…ç½®éš§é“è®¾ç½®
```

### 2. Cloudflare Zero Trust / Access â­â­â­

#### åŠŸèƒ½æ¸…å•
```rust
// Access åº”ç”¨ç®¡ç†
- åˆ—å‡ºæ‰€æœ‰ Access åº”ç”¨
- åˆ›å»ºæ–°çš„ Access åº”ç”¨
- é…ç½®åº”ç”¨åŸŸåå’Œè·¯å¾„
- åˆ é™¤åº”ç”¨

// è®¿é—®ç­–ç•¥
- åˆ›å»ºè®¿é—®ç­–ç•¥
- ç®¡ç†ç”¨æˆ·/ç»„/é‚®ç®±è§„åˆ™
- é…ç½® MFA è¦æ±‚
- è®¾ç½®ä¼šè¯æŒç»­æ—¶é—´

// ç”¨æˆ·ç®¡ç†
- æŸ¥çœ‹æˆæƒç”¨æˆ·åˆ—è¡¨
- æ·»åŠ /ç§»é™¤ç”¨æˆ·
- é…ç½®ç”¨æˆ·ç»„

// å®¡è®¡æ—¥å¿—
- æŸ¥çœ‹è®¿é—®æ—¥å¿—
- å¯¼å‡ºå®¡è®¡è®°å½•
- å®æ—¶ç›‘æ§è®¿é—®
```

### 3. ç»Ÿè®¡ä¸ç›‘æ§ â­â­

#### å·²å®ç°
- âœ… åŸºç¡€ metrics è·å–ï¼ˆä» 127.0.0.1:20241/metricsï¼‰
- âœ… å®æ—¶ç›‘æ§æ¡†æ¶

#### å¾…å®Œå–„
```rust
// éš§é“å¥åº·ç›‘æ§
- è¿æ¥æ•°
- è¯·æ±‚é€Ÿç‡
- é”™è¯¯ç‡
- å¸¦å®½ä½¿ç”¨

// æ€§èƒ½åˆ†æ
- å»¶è¿Ÿç»Ÿè®¡
- å“åº”æ—¶é—´
- ååé‡å›¾è¡¨
- å†å²æ•°æ®è®°å½•

// å‘Šè­¦åŠŸèƒ½
- è¿æ¥ä¸­æ–­å‘Šè­¦
- æ€§èƒ½ä¸‹é™æé†’
- é”™è¯¯ç‡é˜ˆå€¼
```

### 4. æ™ºèƒ½åŠŸèƒ½ â­â­

#### å·²å®ç°
- âœ… æœ¬åœ°æœåŠ¡æ‰«æï¼ˆå¸¸è§ç«¯å£ï¼‰

#### å¾…æ‰©å±•
```rust
// è‡ªåŠ¨å‘ç°
- Docker å®¹å™¨æ£€æµ‹
- Kubernetes æœåŠ¡å‘ç°
- systemd æœåŠ¡è¯†åˆ«
- è¿›ç¨‹ç«¯å£æ˜ å°„

// æ™ºèƒ½å»ºè®®
- åŸŸåå‘½åå»ºè®®
- å®‰å…¨é…ç½®æ¨è
- æ€§èƒ½ä¼˜åŒ–å»ºè®®
- æœ€ä½³å®è·µæ£€æŸ¥

// æ¨¡æ¿ç³»ç»Ÿ
- å¸¸ç”¨é…ç½®æ¨¡æ¿
- ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆ
- åœºæ™¯åŒ–é…ç½®
```

### 5. é…ç½®ç®¡ç† â­

#### å·²å®ç°
- âœ… API é…ç½®å­˜å‚¨ï¼ˆ~/.cft/config.jsonï¼‰
- âœ… é…ç½®åŠ è½½/ä¿å­˜

#### å¾…å®ç°
```rust
// é…ç½®å¯¼å…¥å¯¼å‡º
- å¯¼å‡ºå®Œæ•´é…ç½®
- è·¨æœºå™¨é…ç½®åŒæ­¥
- é…ç½®ç‰ˆæœ¬ç®¡ç†
- é…ç½®å¤‡ä»½æ¢å¤

// å¤šç¯å¢ƒç®¡ç†
- å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢
- ç¯å¢ƒéš”ç¦»
- æ‰¹é‡æ“ä½œ
```

---

## ğŸ“‹ å®ç°ä¼˜å…ˆçº§

### ğŸ”¥ ç¬¬ä¸€é˜¶æ®µï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. **å®Œå–„ DNS ç®¡ç†**
   - å®ç°å®Œæ•´çš„ CRUD æ“ä½œ
   - è‡ªåŠ¨åŒæ­¥éš§é“è·¯ç”±
   
2. **åŸºç¡€ Access é›†æˆ**
   - åˆ—å‡ºå’Œåˆ›å»ºåº”ç”¨
   - åŸºæœ¬ç­–ç•¥é…ç½®

3. **æ”¹è¿›ç›‘æ§**
   - å®Œå–„ metrics è§£æ
   - æ·»åŠ å†å²è®°å½•

### â­ ç¬¬äºŒé˜¶æ®µï¼ˆå¢å¼ºä½“éªŒï¼‰
4. **æ™ºèƒ½æœåŠ¡å‘ç°**
   - Docker é›†æˆ
   - è‡ªåŠ¨é…ç½®å»ºè®®

5. **æ¨¡æ¿ç³»ç»Ÿ**
   - å¸¸ç”¨åœºæ™¯æ¨¡æ¿
   - ä¸€é”®éƒ¨ç½²

6. **é…ç½®åŒæ­¥**
   - å¯¼å…¥å¯¼å‡º
   - äº‘ç«¯å¤‡ä»½

### ğŸš€ ç¬¬ä¸‰é˜¶æ®µï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
7. **å®Œæ•´ Zero Trust é›†æˆ**
   - Gateway è§„åˆ™
   - WARP è®¾å¤‡ç®¡ç†
   - DLP ç­–ç•¥

8. **é«˜çº§ç›‘æ§**
   - å›¾è¡¨å¯è§†åŒ–
   - å‘Šè­¦ç³»ç»Ÿ
   - æ€§èƒ½åˆ†æ

9. **å›¢é˜Ÿåä½œ**
   - å¤šç”¨æˆ·ç®¡ç†
   - æƒé™æ§åˆ¶
   - å®¡è®¡æ—¥å¿—

---

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cargo build --release
sudo cp target/release/cft /usr/local/bin/
```

### 2. é…ç½® API
```bash
cft config set
# è¾“å…¥ä½ çš„ Cloudflare API Token
```

### 3. å¼€å§‹ä½¿ç”¨
```bash
# è¿›å…¥äº¤äº’å¼èœå•
cft

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
cft dns list
cft stats
cft scan
```

---

## ğŸ“– è¯¦ç»†åŠŸèƒ½è¯´æ˜

### DNS ç®¡ç†

#### åˆ—å‡º DNS è®°å½•
```bash
cft dns list                      # äº¤äº’å¼é€‰æ‹©åŸŸå
cft dns list example.com          # æŒ‡å®šåŸŸå
```

#### æ·»åŠ  DNS è®°å½•
```bash
cft dns add subdomain example.com CNAME target.com
cft dns add @ example.com A 1.2.3.4
```

#### æ‰¹é‡æ“ä½œ
```bash
# é€šè¿‡äº¤äº’å¼èœå•
cft
# é€‰æ‹© "ğŸŒ DNS ç®¡ç†" -> "ğŸ”„ åŒæ­¥éš§é“è·¯ç”±"
# è‡ªåŠ¨ä¸ºæ‰€æœ‰æ˜ å°„åˆ›å»º/æ›´æ–° DNS è®°å½•
```

---

### Access ç®¡ç†

#### åˆ›å»ºå—ä¿æŠ¤åº”ç”¨
```bash
cft access create my-app
# äº¤äº’å¼é…ç½®åŸŸåã€ç­–ç•¥ç­‰
```

#### é…ç½®è®¿é—®ç­–ç•¥
```bash
# ç¤ºä¾‹ï¼šåªå…è®¸ç‰¹å®šé‚®ç®±è®¿é—®
- å…è®¸: user@example.com
- è¦æ±‚: MFA
- ä¼šè¯: 24å°æ—¶
```

---

### ç›‘æ§åŠŸèƒ½

#### æŸ¥çœ‹å®æ—¶ç»Ÿè®¡
```bash
cft stats                          # æ˜¾ç¤ºå½“å‰ç»Ÿè®¡
cft monitor                        # å®æ—¶ç›‘æ§ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼‰
```

#### Metrics ç«¯ç‚¹
cloudflared åœ¨ `127.0.0.1:20241/metrics` æš´éœ² Prometheus æ ¼å¼çš„ metricsï¼š
- `cloudflared_tunnel_total_requests` - æ€»è¯·æ±‚æ•°
- `cloudflared_tunnel_active_streams` - æ´»è·ƒè¿æ¥æ•°
- `cloudflared_tunnel_response_time` - å“åº”æ—¶é—´
- æ›´å¤šæŒ‡æ ‡...

---

### æ™ºèƒ½æœåŠ¡å‘ç°

#### æ‰«ææœ¬åœ°æœåŠ¡
```bash
cft scan
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ” æ‰«ææœ¬åœ°æœåŠ¡...

å‘ç°çš„æœåŠ¡:
  âœ… ç«¯å£ 3000 - React/Node.js
  âœ… ç«¯å£ 8080 - HTTP Alternate
  
æ˜¯å¦ä¸ºå‘ç°çš„æœåŠ¡åˆ›å»ºæ˜ å°„? yes
ä¸º 3000 (React/Node.js) è®¾ç½®åŸŸå: app.example.com
ä¸º 8080 (HTTP Alternate) è®¾ç½®åŸŸå: api.example.com
```

---

## ğŸ” API Token æƒé™è¦æ±‚

åˆ›å»º API Token æ—¶éœ€è¦ä»¥ä¸‹æƒé™ï¼š

### å¿…éœ€æƒé™
- **Account - Cloudflare Tunnel: Edit**
  - ç®¡ç†éš§é“
- **Zone - DNS: Edit**
  - ç®¡ç† DNS è®°å½•

### å¯é€‰æƒé™ï¼ˆZero Trust åŠŸèƒ½ï¼‰
- **Account - Access: Edit**
  - ç®¡ç† Access åº”ç”¨å’Œç­–ç•¥
- **Account - Gateway: Edit**
  - ç®¡ç† Gateway è§„åˆ™
- **Account - Zero Trust: Edit**
  - å®Œæ•´çš„ Zero Trust ç®¡ç†

### è·å–æ­¥éª¤
1. è®¿é—® https://dash.cloudflare.com/profile/api-tokens
2. ç‚¹å‡» "Create Token"
3. ä½¿ç”¨ "Edit Cloudflare Zero Trust" æ¨¡æ¿
4. æˆ–è‡ªå®šä¹‰æƒé™
5. å¤åˆ¶ Token å¹¶è¿è¡Œ `cft config set`

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¿«é€Ÿéƒ¨ç½²æ–°æœåŠ¡
```bash
# 1. æ‰«ææœ¬åœ°æœåŠ¡
cft scan

# 2. è‡ªåŠ¨åˆ›å»ºæ˜ å°„
# ç¨‹åºä¼šå»ºè®®åŸŸåå’Œé…ç½®

# 3. æ·»åŠ  Access ä¿æŠ¤ï¼ˆå¯é€‰ï¼‰
cft access create my-app

# 4. å®Œæˆï¼
```

### åœºæ™¯ 2: ç®¡ç†å¤šä¸ªéš§é“
```bash
# 1. æŸ¥çœ‹æ‰€æœ‰éš§é“
cft list

# 2. åˆ‡æ¢åˆ°æŒ‡å®šéš§é“
cft switch

# 3. æŸ¥çœ‹å½“å‰é…ç½®
cft show

# 4. æ·»åŠ æ–°æ˜ å°„
cft map
```

### åœºæ™¯ 3: ç›‘æ§å’Œè¯Šæ–­
```bash
# 1. å¥åº·æ£€æŸ¥
cft check

# 2. æŸ¥çœ‹ç»Ÿè®¡
cft stats

# 3. å®æ—¶ç›‘æ§
cft monitor

# 4. å¦‚æœ‰é—®é¢˜ï¼Œè‡ªåŠ¨ä¿®å¤
cft fix
```

---

## ğŸ”„ ä» v2.0 å‡çº§

v3.0 å®Œå…¨å…¼å®¹ v2.0 çš„é…ç½®æ–‡ä»¶å’ŒåŠŸèƒ½ï¼š

```bash
# 1. å¤‡ä»½ç°æœ‰é…ç½®ï¼ˆå¯é€‰ï¼‰
cp -r /etc/cloudflared /etc/cloudflared.backup

# 2. å®‰è£…æ–°ç‰ˆæœ¬
cargo build --release
sudo cp target/release/cft /usr/local/bin/

# 3. é…ç½® APIï¼ˆæ–°åŠŸèƒ½ï¼‰
cft config set

# 4. éªŒè¯
cft check
```

---

## ğŸ› æ•…éšœæ’é™¤

### API è¿æ¥å¤±è´¥
```bash
# æµ‹è¯• API Token
cft config test

# æ£€æŸ¥ Token æƒé™
# è®¿é—® https://dash.cloudflare.com/profile/api-tokens
```

### æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# è¿è¡Œè¯Šæ–­
cft debug

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u cloudflared-tunnel -n 100
```

---

## ğŸ“š API å‚è€ƒ

### Cloudflare API ç«¯ç‚¹

#### éš§é“ç®¡ç†
- `GET /accounts/:account_id/tunnels` - åˆ—å‡ºéš§é“
- `POST /accounts/:account_id/tunnels` - åˆ›å»ºéš§é“
- `GET /accounts/:account_id/tunnels/:tunnel_id` - éš§é“è¯¦æƒ…
- `DELETE /accounts/:account_id/tunnels/:tunnel_id` - åˆ é™¤éš§é“

#### DNS ç®¡ç†
- `GET /zones/:zone_id/dns_records` - åˆ—å‡ºè®°å½•
- `POST /zones/:zone_id/dns_records` - æ·»åŠ è®°å½•
- `PUT /zones/:zone_id/dns_records/:record_id` - æ›´æ–°è®°å½•
- `DELETE /zones/:zone_id/dns_records/:record_id` - åˆ é™¤è®°å½•

#### Access ç®¡ç†
- `GET /accounts/:account_id/access/apps` - åˆ—å‡ºåº”ç”¨
- `POST /accounts/:account_id/access/apps` - åˆ›å»ºåº”ç”¨
- `GET /accounts/:account_id/access/apps/:app_id/policies` - åˆ—å‡ºç­–ç•¥
- `POST /accounts/:account_id/access/apps/:app_id/policies` - åˆ›å»ºç­–ç•¥

å®Œæ•´ API æ–‡æ¡£ï¼šhttps://developers.cloudflare.com/api/

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®ï¼

### å¼€å‘è®¡åˆ’
æŸ¥çœ‹ GitHub Issues äº†è§£å½“å‰å¼€å‘è®¡åˆ’å’Œ TODO åˆ—è¡¨ã€‚

### æäº¤ PR
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ PR

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v3.0.0 (å¼€å‘ä¸­)
- âœ¨ æ–°å¢ Cloudflare API é›†æˆ
- âœ¨ æ–°å¢ DNS ç®¡ç†åŠŸèƒ½
- âœ¨ æ–°å¢ Zero Trust / Access æ”¯æŒ
- âœ¨ æ–°å¢ç»Ÿè®¡å’Œç›‘æ§åŠŸèƒ½
- âœ¨ æ–°å¢æ™ºèƒ½æœåŠ¡å‘ç°
- âœ¨ æ”¹è¿›äº¤äº’å¼ç•Œé¢

### v2.0.0
- âœ¨ äº¤äº’å¼èœå•
- âœ¨ è‡ªåŠ¨æƒé™ç®¡ç†
- âœ¨ å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
- âœ¨ è°ƒè¯•æ¨¡å¼

### v1.0.0
- âœ¨ åŸºç¡€éš§é“ç®¡ç†
- âœ¨ æ˜ å°„é…ç½®
- âœ¨ æœåŠ¡æ§åˆ¶

---

## ğŸ“„ License

MIT License